angular.module("multipleDatePicker",[]).factory("multipleDatePickerBroadcast",["$rootScope",function(a){var b={};return b.calendarId=null,b.message="",b.resetOrder=function(a){this.message="reset",this.calendarId=a,this.broadcastItem()},b.broadcastItem=function(){a.$broadcast("handleMultipleDatePickerBroadcast")},b}]).directive("multipleDatePicker",["$log","multipleDatePickerBroadcast",function(a,b){"use strict";return{restrict:"AE",scope:{calendarId:"=?",dayClick:"=?",dayHover:"=?",month:"=?",monthChanged:"=?",daysSelected:"=?",weekDaysOff:"=?",highlightDays:"=?",allDaysOff:"=?",sundayFirstDay:"=?",disallowBackPastMonths:"=?",disallowGoFuturMonths:"=?",showDaysOfSurroundingMonths:"=?",cssDaysOfSurroundingMonths:"=?",fireEventsForDaysOfSurroundingMonths:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?",dateRange:"=?",rangeStart:"=?",rangeEnd:"=?"},template:'<div class="multiple-date-picker"><div class="picker-top-row"><div class="text-center picker-navigate picker-navigate-left-arrow" ng-class="{\'disabled\':disableBackButton}" ng-click="previousMonth()">&lt;</div><div class="text-center picker-month">{{month.format(\'MMMM YYYY\')}}</div><div class="text-center picker-navigate picker-navigate-right-arrow" ng-class="{\'disabled\':disableNextButton}" ng-click="nextMonth()">&gt;</div></div><div class="picker-days-week-row"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div></div><div class="picker-days-row">'+"<div class=\"text-center picker-day {{!day.otherMonth || showDaysOfSurroundingMonths ? day.css : ''}} {{day.otherMonth ? cssDaysOfSurroundingMonths : ''}}\" title=\"{{day.title}}\" ng-repeat=\"day in days\" ng-click=\"toggleDay($event, day)\" ng-mouseover=\"hoverDay($event, day)\" ng-mouseleave=\"dayHover($event, day)\" ng-class=\"{'picker-selected':day.selected, 'picker-off':!day.selectable, 'today':day.today,'past':day.past,'future':day.future, 'picker-other-month':day.otherMonth}\">{{day ? day.otherMonth && !showDaysOfSurroundingMonths ? '&nbsp;' : day.format('D') : ''}}</div></div></div>",link:function(a){var c=function(){var b=moment(),c=moment(a.month).subtract(1,"month"),d=moment(a.month).add(1,"month");a.disableBackButton=a.disallowBackPastMonths&&b.isAfter(c,"month"),a.disableNextButton=a.disallowGoFuturMonths&&b.isBefore(d,"month")},d=function(){for(var b=moment().localeData()._weekdaysMin,c=[],d=1;7>d;d++)c.push(b[d]);return a.sundayFirstDay?c.splice(0,0,b[0]):c.push(b[0]),c},e=function(){var b=a.daysSelected||[],c=[];b.map(function(a){c.push(moment(a))}),a.convertedDaysSelected=c,a.generate()};a.$on("handleMultipleDatePickerBroadcast",function(){"reset"!==b.message||b.calendarId&&b.calendarId!==a.calendarId||e()}),a.$watch("daysSelected",function(a){a&&e()},!0),a.$watch("weekDaysOff",function(){a.generate()},!0),a.$watch("highlightDays",function(){a.generate()},!0),a.$watch("allDaysOff",function(){a.generate()},!0),a.$watch("rangeStart",function(){a.rangeStart&&moment.isMoment(a.rangeStart)&&a.rangeEnd&&moment.isMoment(a.rangeEnd)&&(a.dateRange=moment.range(a.rangeStart,a.rangeEnd),a.generate())},!0),a.$watch("rangeEnd",function(){a.rangeStart&&moment.isMoment(a.rangeStart)&&a.rangeEnd&&moment.isMoment(a.rangeEnd)&&(a.dateRange=moment.range(a.rangeStart,a.rangeEnd),a.generate())},!0),a.$watch("disableDaysBefore",function(){a.disableDaysBefore&&moment.isMoment(a.disableDaysBefore)&&a.disableDaysBefore.isAfter(a.rangeStart)&&(a.month=a.disableDaysBefore,a.dateRange=void 0,a.rangeStart=void 0,a.rangeEnd=void 0),a.generate()},!0),a.month=a.month||moment().startOf("day"),a.days=[],a.convertedDaysSelected=a.convertedDaysSelected||[],a.weekDaysOff=a.weekDaysOff||[],a.daysOff=a.daysOff||[],a.disableBackButton=!1,a.disableNextButton=!1,a.daysOfWeek=d(),a.cssDaysOfSurroundingMonths=a.cssDaysOfSurroundingMonths||"picker-empty",a.toggleDay=function(b,c){if(b.preventDefault(),!c.otherMonth||a.fireEventsForDaysOfSurroundingMonths){var d=!1;b.preventDefault=function(){d=!0},"function"==typeof a.dayClick&&a.dayClick(b,c),c.selectable&&!d&&(!a.rangeStart||a.rangeStart&&a.rangeEnd||a.rangeStart&&c.isBefore(a.rangeStart)?(a.dateRange={},a.rangeStart=c,a.rangeEnd=void 0,a.days.forEach(function(b){b.selected=!1,b.selectable?a.rangeStart.isSame(b)?(b.css="range-start",b.title="range-start"):(b.css="",b.title=""):(b.css="picker-off",b.title="picker-off")}),c.selected=!0,a.convertedDaysSelected.length=0,a.convertedDaysSelected.push(c)):(a.rangeEnd=c,c.selected=!0,a.convertedDaysSelected.push(c),a.dateRange=moment.range(a.rangeStart,a.rangeEnd),a.days.forEach(function(b){b.selected=!1,b.selectable?a.dateRange&&a.dateRange.start&&a.dateRange.start.isSame(b)?(b.css="range-start",b.title="range-start"):a.dateRange&&a.dateRange.end&&a.dateRange.end.isSame(b)?(b.css="range-end",b.title="range-end"):a.dateRange&&a.dateRange.contains&&b.within(a.dateRange)?(b.css="within-range",b.title="within-range"):(b.css="",b.title=""):(b.css="picker-off",b.title="picker-off")})))}},a.hoverDay=function(b,c){b.preventDefault();var d=!1;b.preventDefault=function(){d=!0},"function"==typeof a.dayHover&&a.dayHover(b,c),d||(c.hover="mouseover"===b.type)},a.previousMonth=function(){if(!a.disableBackButton){var b=moment(a.month);a.month=a.month.subtract(1,"month"),"function"==typeof a.monthChanged&&a.monthChanged(a.month,b),a.generate()}},a.nextMonth=function(){if(!a.disableNextButton){var b=moment(a.month);a.month=a.month.add(1,"month"),"function"==typeof a.monthChanged&&a.monthChanged(a.month,b),a.generate()}},a.isDayOff=function(a,b){return a.allDaysOff||!!a.disableDaysBefore&&moment(b).isBefore(a.disableDaysBefore,"day")||!!a.disableDaysAfter&&moment(b).isAfter(a.disableDaysAfter,"day")||angular.isArray(a.weekDaysOff)&&a.weekDaysOff.some(function(a){return b.day()===a})||angular.isArray(a.daysOff)&&a.daysOff.some(function(a){return b.isSame(a,"day")})||angular.isArray(a.highlightDays)&&a.highlightDays.some(function(a){return b.isSame(a.date,"day")&&!a.selectable})},a.isSelected=function(a,b){return a.convertedDaysSelected.some(function(a){return b.isSame(a,"day")})},a.generate=function(){!a.dateRange&&a.rangeStart&&a.rangeEnd&&(a.dateRange=moment.range(a.rangeStart,a.rangeEnd));var b=moment(a.month).date(0).day(a.sundayFirstDay?0:1).subtract(1,"days"),d=moment(a.month).date(1),e=[],f=moment(),g=moment(d).endOf("month"),h=function(){var c=moment(b.add(1,"days"));if(angular.isArray(a.highlightDays)){var d=a.highlightDays.filter(function(a){return c.isSame(a.date,"day")});c.css=d.length>0?d[0].css:"",c.title=d.length>0?d[0].title:""}return c.selectable=!a.isDayOff(a,c),c.selected=a.isSelected(a,c),c.today=c.isSame(f,"day"),c.past=c.isBefore(f,"day"),c.future=c.isAfter(f,"day"),c.isSame(a.month,"month")||(c.otherMonth=!0),c.selectable?a.dateRange&&a.dateRange.start&&moment.isMoment(a.dateRange.start)&&a.dateRange.start.isSame(c)?(c.css="range-start",c.title="range-start"):a.dateRange&&a.dateRange.end&&moment.isMoment(a.dateRange.end)&&a.dateRange.end.isSame(c)?(c.css="range-end",c.title="range-end"):a.dateRange&&a.dateRange.contains&&c.within(a.dateRange)?(c.css="within-range",c.title="within-range"):(c.css="",c.title=""):(c.css="picker-off",c.title="picker-off"),c},i=g.diff(b,"days"),j=a.sundayFirstDay?6:0;g.day()!==j&&(i+=(a.sundayFirstDay?6:7)-g.day());for(var k=0;i>k;k++)e.push(h());a.days=e,c()},a.generate()}}}]);