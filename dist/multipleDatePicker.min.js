!function(e){"use strict";var t=function(){return{restrict:"AE",scope:{ngModel:"=?",highlightDays:"=?",dayClick:"=?",dayHover:"=?",rightClick:"=?",month:"=?",monthChanged:"=?",yearChanged:"=?",monthClick:"=?",weekDaysOff:"=?",allDaysOff:"=?",daysAllowed:"=?",sundayFirstDay:"=?",disableNavigation:"=?",disallowBackPastMonths:"=?",disallowGoFuturMonths:"=?",showDaysOfSurroundingMonths:"=?",cssDaysOfSurroundingMonths:"=?",fireEventsForDaysOfSurroundingMonths:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?",changeYearPast:"=?",changeYearFuture:"=?",enableSelectMonth:"=?",moment:"=?"},template:'<div class="multiple-date-picker"><div class="picker-top-row"><div class="text-center picker-navigate picker-navigate-left-arrow" ng-class="{\'disabled\':disableBackButton}" ng-click="changeMonth($event, disableBackButton, -1)">&lt;</div><div class="text-center picker-month"><span ng-if="!enableSelectMonth">{{monthToDisplay}}</span><select ng-if="enableSelectMonth" ng-model="select.month" ng-change="changeMonthBySelect(select.month)" ng-options="m for m in monthsForSelect"></select>&nbsp;<span ng-if="yearsForSelect.length < 2">{{yearToDisplay}}</span><select ng-if="yearsForSelect.length > 1" ng-model="select.year" ng-change="changeYear(select.year)" ng-options="y for y in yearsForSelect"></select></div><div class="text-center picker-navigate picker-navigate-right-arrow" ng-class="{\'disabled\':disableNextButton}" ng-click="changeMonth($event, disableNextButton, 1)">&gt;</div></div><div class="picker-days-week-row"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div></div><div class="picker-days-row"><div class="text-center picker-day {{getDayClasses(day)}}" title="{{day.title}}" ng-repeat="day in days" ng-click="toggleDay($event, day)" ng-mouseover="hoverDay($event, day)" ng-mouseleave="dayHover($event, day)" mdp-right-click="rightClicked($event,day)">{{day ? day.mdp.otherMonth && !showDaysOfSurroundingMonths ? \'&nbsp;\' : day.date.format(\'D\') : \'\'}}</div></div></div>',link:function(t){function a(e){var a=n(t.month);t.month=e,t.select.month=e.format("MMMM"),"function"==typeof t.monthChanged&&t.monthChanged(t.month,a)}var n=window.moment||t.moment;t.ngModel=t.ngModel||[];var o=function(){var e=n(),a=n(t.month).subtract(1,"month"),o=n(t.month).add(1,"month");t.disableBackButton=t.disableNavigation||t.disallowBackPastMonths&&e.isAfter(a,"month"),t.disableNextButton=t.disableNavigation||t.disallowGoFuturMonths&&e.isBefore(o,"month")},s=function(){for(var e=n().localeData()._weekdaysMin,a=[],o=1;o<7;o++)a.push(e[o]);return t.sundayFirstDay?a.splice(0,0,e[0]):a.push(e[0]),a},r=function(){var e=t.month.format("MMMM");return e.charAt(0).toUpperCase()+e.slice(1)},i=function(){var e=n(),a=Math.max(0,parseInt(t.changeYearPast,10)||0),o=Math.max(0,parseInt(t.changeYearFuture,10)||0),s=n(t.month).subtract(a,"year"),r=n(t.month).add(o,"year"),i=[];r.add(1,"year");for(var d=n(s);r.isAfter(d,"YEAR");d.add(1,"year"))t.disallowBackPastMonths&&!d.isAfter(e,"year")&&!d.isSame(e,"year")||t.disallowGoFuturMonths&&!d.isBefore(e,"year")&&!d.isSame(e,"year")||i.push(d.format("YYYY"));return i},d=[];d.push(t.$watch("ngModel",function(){t.generate()},!0)),d.push(t.$watch("month",function(){t.generate()},!0)),d.push(t.$watch("highlightDays",function(){t.generate()},!0)),d.push(t.$watch("weekDaysOff",function(){t.generate()},!0)),d.push(t.$watch("allDaysOff",function(){t.generate()},!0)),d.push(t.$watch("daysAllowed",function(){t.generate()},!0)),d.push(t.$watch("disableDaysBefore",function(){t.generate()},!0)),d.push(t.$watch("disableDaysAfter",function(){t.generate()},!0)),d.push(t.$watch(function(){return n.locale()},function(e){t.month.locale(e),t.daysOfWeek=s(),t.monthToDisplay=r()},!0)),t.$on("destroy",function(){for(var e=0;e<d.length;e++)d[e]()}),t.month=t.month||n().startOf("day"),t.days=[],t.weekDaysOff=t.weekDaysOff||[],t.daysOff=t.daysOff||[],t.disableBackButton=!1,t.disableNextButton=!1,t.daysOfWeek=s(),t.cssDaysOfSurroundingMonths=t.cssDaysOfSurroundingMonths||"picker-empty",t.yearsForSelect=[],t.monthsForSelect=[],t.select={},t.toggleDay=function(e,a){if(e.preventDefault(),!a.mdp.otherMonth||t.fireEventsForDaysOfSurroundingMonths){var o=!1;if(e.preventDefault=function(){o=!0},"function"==typeof t.dayClick&&t.dayClick(e,a),a.selectable&&!o)if(a.mdp.selected=!a.mdp.selected,a.mdp.selected){if(t.ngModel.push(a.date),e.ctrlKey||e.shiftKey){t.ngModel.sort(function(e,t){return e-t});for(var s=0;s<t.ngModel.length;++s)if(t.ngModel[s].isSame(a.date,"day")){var r=t.ngModel[s-1];if(void 0===r)break;for(var i=t.ngModel[s],d=n(r.format("YYYY-MM-DD"),"YYYY-MM-DD").add(1,"days");d<i;)t.ngModel.push(n(d)),d=n(d.format("YYYY-MM-DD"),"YYYY-MM-DD").add(1,"days");break}}}else{for(var l=-1,c=0;c<t.ngModel.length;++c)if(n.isMoment(t.ngModel[c])){if(t.ngModel[c].isSame(a.date,"day")){l=c;break}}else if(t.ngModel[c].date.isSame(a.date,"day")){l=c;break}l!==-1&&t.ngModel.splice(l,1)}}},t.hoverDay=function(e,a){e.preventDefault();var n=!1;e.preventDefault=function(){n=!0},"function"==typeof t.dayHover&&t.dayHover(e,a),n||(a.mdp.hover="mouseover"===e.type)},t.rightClicked=function(e,a){"function"==typeof t.rightClick&&(e.preventDefault(),t.rightClick(e,a))},t.getDayClasses=function(e){var a="";return!e.css||e.mdp.otherMonth&&!t.showDaysOfSurroundingMonths||(a+=" "+e.css),t.cssDaysOfSurroundingMonths&&e.mdp.otherMonth&&(a+=" "+t.cssDaysOfSurroundingMonths),e.mdp.selected&&(a+=" picker-selected"),e.selectable||(a+=" picker-off"),e.mdp.today&&(a+=" today"),e.mdp.past&&(a+=" past"),e.mdp.future&&(a+=" future"),e.mdp.otherMonth&&(a+=" picker-other-month"),a},t.changeMonth=function(e,o,s){if(!o){e.preventDefault();var r=!1;e.preventDefault=function(){r=!0};var i=n(t.month).add(s,"month");"function"==typeof t.monthClick&&t.monthClick(e,i),r||a(i)}},t.changeMonthBySelect=function(e){a(n(t.month).month(e))},t.changeYear=function(e){var a=n(t.month);t.month=t.month.year(parseInt(e,10)),"function"==typeof t.yearChanged&&t.yearChanged(t.month,a)},t.isDayOff=function(a){return t.allDaysOff||!!t.disableDaysBefore&&n(a.date).isBefore(t.disableDaysBefore,"day")||!!t.disableDaysAfter&&n(a.date).isAfter(t.disableDaysAfter,"day")||e.isArray(t.weekDaysOff)&&t.weekDaysOff.some(function(e){return a.date.day()===e})||e.isArray(t.daysOff)&&t.daysOff.some(function(e){return a.date.isSame(e,"day")})||e.isArray(t.daysAllowed)&&!t.daysAllowed.some(function(e){return a.date.isSame(e,"day")})||e.isArray(t.highlightDays)&&t.highlightDays.some(function(e){return a.date.isSame(e.date,"day")&&!e.selectable})},t.isSelected=function(e){return t.ngModel.some(function(t){return e.date.isSame(t,"day")})},t.generate=function(){t.monthsForSelect=n.months(),t.yearsForSelect=i(),t.monthToDisplay=r(),t.yearToDisplay=t.month.format("YYYY"),t.select={year:t.month.year().toString(),month:t.month.format("MMMM")};var a=n(t.month).date(0).day(t.sundayFirstDay?0:1).subtract(1,"day");n(t.month).date(0).diff(a,"day")>6&&(a=a.add(1,"week"));var s=n(t.month).date(1),d=[],l=n(),c=n(s).endOf("month"),h=function(){var o={date:n(a.add(1,"day")),mdp:{selected:!1}};if(e.isArray(t.highlightDays)){var s=t.highlightDays.filter(function(e){return o.date.isSame(e.date,"day")});o.css=s.length>0?s[0].css:"",o.title=s.length>0?s[0].title:""}return o.selectable=!t.isDayOff(o),o.mdp.selected=t.isSelected(o),o.mdp.today=o.date.isSame(l,"day"),o.mdp.past=o.date.isBefore(l,"day"),o.mdp.future=o.date.isAfter(l,"day"),o.date.isSame(t.month,"month")||(o.mdp.otherMonth=!0),o},f=c.diff(a,"days"),y=t.sundayFirstDay?6:0;c.day()!==y&&(f+=(t.sundayFirstDay?6:7)-c.day());for(var u=0;u<f;u++)d.push(h());t.days=d,o()},t.generate()}}};e.module("multipleDatePicker",[]).directive("multipleDatePicker",t).directive("mdpRightClick",["$parse",function(e){return function(t,a,n){var o=e(n.mdpRightClick);a.bind("contextmenu",function(e){t.$apply(function(){o(t,{$event:e})})})}}])}(window.angular);