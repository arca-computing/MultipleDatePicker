angular.module("multipleDatePicker",[]).directive("multipleDatePicker",["$log",function(a){"use strict";return{restrict:"AE",scope:{callback:"&",dayClick:"=?",dayHover:"=?",monthChanged:"=?",daysSelected:"=?",weekDaysOff:"=?",daysOff:"=?",disallowBackPastMonths:"=",disallowGoFuturMonths:"="},template:'<div class="multiple-date-picker"><div class="picker-top-row"><div class="text-center picker-navigate" ng-class="{\'disabled\':disableBackButton}" ng-click="previousMonth()">&lt;</div><div class="text-center picker-month">{{month.format(\'MMMM YYYY\')}}</div><div class="text-center picker-navigate" ng-class="{\'disabled\':disableNextButton}" ng-click="nextMonth()">&gt;</div></div><div class="picker-days-week-row"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div></div><div class="picker-days-row"><div class="text-center picker-day picker-empty" ng-repeat="x in emptyFirstDays">&nbsp;</div><div class="text-center picker-day" ng-repeat="day in days" ng-click="toggleDay($event, day)" ng-mouseover="hoverDay($event, day)" ng-mouseleave="dayHover($event, day)" ng-class="{\'picker-selected\':day.selected, \'picker-off\':!day.selectable, \'today\':day.today}">{{day ? day.format(\'D\') : \'\'}}</div><div class="text-center picker-day picker-empty" ng-repeat="x in emptyLastDays">&nbsp;</div></div></div>',link:function(b){var c=function(){var a=moment(),c=moment(b.month).subtract(1,"month"),d=moment(b.month).add(1,"month");b.disableBackButton=b.disallowBackPastMonths&&a.isAfter(c,"month"),b.disableNextButton=b.disallowGoFuturMonths&&a.isBefore(d,"month")};b.$watch("daysSelected",function(a){if(a){var c=[];a.map(function(a){c.push(moment(a))}),b.convertedDaysSelected=c,b.generate()}},!0),b.$watch("weekDaysOff",function(){b.generate()},!0),b.$watch("daysOff",function(){b.generate()},!0),b.month=b.month||moment().startOf("day"),b.days=[],b.convertedDaysSelected=b.convertedDaysSelected||[],b.weekDaysOff=b.weekDaysOff||[],b.daysOff=b.daysOff||[],b.disableBackButton=!1,b.disableNextButton=!1;var d=moment().localeData()._weekdaysMin;b.daysOfWeek=[d[1],d[2],d[3],d[4],d[5],d[6],d[0]],b.toggleDay=function(c,d){c.preventDefault();var e=!1;c.preventDefault=function(){e=!0},"function"==typeof b.dayClick&&b.dayClick(c,d),d.selectable&&!e&&(d.selected=!d.selected,d.selected?b.convertedDaysSelected.push(d):b.convertedDaysSelected.filter(function(a){return a.valueOf()===d.valueOf()}),"function"==typeof b.callback&&(a.warn("callback option deprecated, please use dayClick"),b.callback({timestamp:d.valueOf(),selected:d.selected})))},b.hoverDay=function(a,c){a.preventDefault();var d=!1;a.preventDefault=function(){d=!0},"function"==typeof b.dayHover&&b.dayHover(a,c),d||(c.hover="mouseover"===a.type?!0:!1)},b.previousMonth=function(){if(!b.disableBackButton){var a=moment(b.month);b.month=b.month.subtract(1,"month"),"function"==typeof b.monthChanged&&b.monthChanged(b.month,a),b.generate()}},b.nextMonth=function(){if(!b.disableNextButton){var a=moment(b.month);b.month=b.month.add(1,"month"),"function"==typeof b.monthChanged&&b.monthChanged(b.month,a),b.generate()}},b.isDayOff=function(a,b){return angular.isArray(a.weekDaysOff)&&a.weekDaysOff.some(function(a){return b.day()===a})||angular.isArray(a.daysOff)&&a.daysOff.some(function(a){return b.isSame(a,"day")})},b.isSelected=function(a,b){return a.convertedDaysSelected.some(function(a){return b.isSame(a,"day")})},b.generate=function(){var a=moment(b.month).date(0),d=moment(b.month).date(1),e=[],f=moment(),g=moment(d).endOf("month"),h=g.date();b.emptyFirstDays=[];for(var i=0===d.day()?6:d.day()-1;i>0;i--)b.emptyFirstDays.push({});for(var j=0;h>j;j++){var k=moment(a.add(1,"days"));k.selectable=!b.isDayOff(b,k),k.selected=b.isSelected(b,k),k.today=k.isSame(f,"day"),e.push(k)}b.emptyLastDays=[];for(var l=7-(0===g.day()?7:g.day());l>0;l--)b.emptyLastDays.push({});b.days=e,c()},b.generate()}}}]);