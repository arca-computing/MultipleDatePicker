angular.module("multipleDatePicker",[]).directive("multipleDatePicker",["$log",function(a){"use strict";return{restrict:"AE",scope:{callback:"&",dayClick:"=?",dayHover:"=?",monthChanged:"=?",yearChanged:"=?",daysSelected:"=?",weekDaysOff:"=?",daysOff:"=?",highlightDays:"=?",allDaysOff:"=?",sundayFirstDay:"=?",disallowBackPastMonths:"=",disallowGoFuturMonths:"=",calendarMode:"=?"},template:'<div class="multiple-date-picker"><div class="picker-top-row"><div class="text-center picker-navigate picker-navigate-left-arrow" ng-class="{\'disabled\':disableBackButton}" ng-click="previous()">&lt;</div><div class="text-center picker-month" ng-if="calendarMode==\'Month\'">{{month.format(topRowDateFormat)}}</div><div class="text-center picker-month" ng-if="calendarMode==\'Year\'">{{year.format(topRowDateFormat)}}</div><div class="text-center picker-navigate picker-navigate-right-arrow" ng-class="{\'disabled\':disableNextButton}" ng-click="next()">&gt;</div></div><div class="picker-days-week-row" ng-if="calendarMode==\'Month\'"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div></div><div class="picker-days-row" ng-if="calendarMode==\'Month\'"><div class="text-center picker-date picker-empty" ng-repeat="x in emptyFirstDays">&nbsp;</div><div class="text-center picker-date {{day.css}}" title="{{day.title}}" ng-repeat="day in days" ng-click="toggleDay($event, day)" ng-mouseover="hoverDay($event, day)" ng-mouseleave="dayHover($event, day)" ng-class="{\'picker-selected\':day.selected, \'picker-off\':!day.selectable, \'today\':day.today}">{{day ? day.format(\'D\') : \'\'}}</div><div class="text-center picker-date picker-empty" ng-repeat="x in emptyLastDays">&nbsp;</div></div><div class="picker-months-row" ng-if="calendarMode==\'Year\'"><div class="text-center picker-date picker-month {{date.styles.join(\' \')}}" ng-repeat="date in months" ng-click="toggleDay($event, date)" ng-mouseover="hoverDay($event, date)" ng-mouseleave="dayHover($event, date)" ng-class="{\'picker-selected\':date.selected, \'picker-off\':!date.selectable, \'today\':date.today}">{{date ? date.format(\'MMM\') : \'\'}}</div></div></div>',link:function(b,c,d){var e=function(){var a=moment(),c=moment(b.month).subtract(1,"month"),d=moment(b.month).add(1,"month");b.disableBackButton=b.disallowBackPastMonths&&a.isAfter(c,"month"),b.disableNextButton=b.disallowGoFuturMonths&&a.isBefore(d,"month")},f=function(){for(var a=moment().localeData()._weekdaysMin,c=[],d=1;7>d;d++)c.push(a[d]);return b.sundayFirstDay?c.splice(0,0,a[0]):c.push(a[0]),c};b.$watch("daysSelected",function(a){if(a){var c=[];a.map(function(a){c.push(moment(a))}),b.convertedDaysSelected=c,b.generate()}},!0),b.$watch("weekDaysOff",function(){b.generate()},!0),b.$watch("daysOff",function(c){void 0!==c&&a.warn("daysOff option deprecated since version 1.1.6, please use highlightDays"),b.generate()},!0),b.$watch("highlightDays",function(){b.generate()},!0),b.$watch("allDaysOff",function(){b.generate()},!0),b.month=b.month||moment().startOf("day"),b.year=b.year||moment().startOf("year"),b.days=[],b.convertedDaysSelected=b.convertedDaysSelected||[],b.weekDaysOff=b.weekDaysOff||[],b.daysOff=b.daysOff||[],b.disableBackButton=!1,b.disableNextButton=!1,b.daysOfWeek=f(),b.calendarMode=d.calendarMode?d.calendarMode:"Month",b.topRowDateFormat="Month"==b.calendarMode?"MMMM YYYY":"YYYY",b.toggleDay=function(c,d){c.preventDefault();var e=!1;c.preventDefault=function(){e=!0},"function"==typeof b.dayClick&&b.dayClick(c,d),d.selectable&&!e&&(d.selected=!d.selected,d.selected?b.convertedDaysSelected.push(d):b.convertedDaysSelected=b.convertedDaysSelected.filter(function(a){return a.valueOf()!==d.valueOf()}),"function"==typeof b.callback&&(a.warn("callback option deprecated, please use dayClick"),b.callback({timestamp:d.valueOf(),selected:d.selected})))},b.hoverDay=function(a,c){a.preventDefault();var d=!1;a.preventDefault=function(){d=!0},"function"==typeof b.dayHover&&b.dayHover(a,c),d||(c.hover="mouseover"===a.type?!0:!1)},b.previous=function(){if(!b.disableBackButton){if("Month"==b.calendarMode){var a=moment(b.month);b.month=b.month.subtract(1,"month"),"function"==typeof b.monthChanged&&b.monthChanged(b.month,a)}if("Year"==b.calendarMode){var c=moment(b.year);b.year=b.year.subtract(1,"year"),"function"==typeof b.yearChanged&&b.yearChanged(b.year,c)}b.generate()}},b.next=function(){if(!b.disableNextButton){if("Month"==b.calendarMode){var a=moment(b.month);b.month=b.month.add(1,"month"),"function"==typeof b.monthChanged&&b.monthChanged(b.month,a),b.generate()}if("Year"==b.calendarMode){var c=moment(b.year);b.year=b.year.add(1,"year"),"function"==typeof b.yearChanged&&b.yearChanged(b.year,c)}b.generate()}},b.isDayOff=function(a,b){return a.allDaysOff||angular.isArray(a.weekDaysOff)&&a.weekDaysOff.some(function(a){return b.day()===a})||angular.isArray(a.daysOff)&&a.daysOff.some(function(a){return b.isSame(a,"day")})||angular.isArray(a.highlightDays)&&a.highlightDays.some(function(a){return b.isSame(a.date,"day")&&!a.selectable})},b.isSelected=function(a,b){return a.convertedDaysSelected.some(function(a){return b.isSame(a,"day")})},b.generate=function(){var a=moment(b.month).date(0),c=moment(b.month).date(1),d=[],f=moment(),g=moment(c).endOf("month"),h=g.date(),i=function(){var c=moment(a.add(1,"days"));if(angular.isArray(b.highlightDays)){var d=b.highlightDays.filter(function(a){return c.isSame(a.date,"day")});c.css=d.length>0?d[0].css:"",c.title=d.length>0?d[0].title:""}return c.selectable=!b.isDayOff(b,c),c.selected=b.isSelected(b,c),c.today=c.isSame(f,"day"),c};if("Month"==b.calendarMode){b.emptyFirstDays=[];var j;j=0===c.day()?b.sundayFirstDay?0:6:c.day()-(b.sundayFirstDay?0:1);for(var k=j;k>0;k--)b.emptyFirstDays.push({});for(var l=0;h>l;l++)d.push(i());b.emptyLastDays=[];var m=b.sundayFirstDay?6:7;0!==g.day()||b.sundayFirstDay?m-=g.day():m=0;for(var n=m;n>0;n--)b.emptyLastDays.push({});b.days=d}else if("Year"==b.calendarMode){for(var o=[],p=moment().locale(b.displayLocale||"").localeData()._monthsShort,q=0;q<p.length;++q){var r=moment("1 "+p[q]+" "+b.year.year());if(angular.isArray(b.highlightDays)){var s=b.highlightDays.filter(function(a){return r.isSame(a.date,"month")});r.css=s.length>0?s[0].css:"",r.title=s.length>0?s[0].title:""}r.selectable=!b.isDayOff(b,r),r.selected=b.isSelected(b,r),r.today=r.isSame(f,"day"),o.push(r)}b.months=o,e()}e()},b.generate()}}}]);